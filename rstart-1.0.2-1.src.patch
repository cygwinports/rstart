--- origsrc/rstart-1.0.2/Makefile.am	2005-12-06 16:48:18.000000000 -0600
+++ src/rstart-1.0.2/Makefile.am	2006-06-19 19:05:50.562500000 -0500
@@ -96,41 +96,42 @@
 # commands and contexts
 #
 
-# FIXME: Someone who cares about rstart may want to look into sanitizing
-# the stuff below.
-
 DATA_DIR = $(libdir)/X11/rstart
 
+commands_files =								\
+	commands/ListContexts						\
+	commands/x11r6/Terminal						\
+	commands/x11r6/LoadMonitor					\
+	commands/x11r6/@List						\
+	commands/@List							\
+	commands/ListGenericCommands
+
+contexts_files =							\
+	contexts/default						\
+	contexts/@Aliases						\
+	contexts/x11r6							\
+	contexts/@List
+
 install-data-hook:
-	for name in `find ${srcdir}/commands -print | grep -v CVS` ; do	\
-	    if test -f $$name; then					\
-	        sed							\
+	for name in $(commands_files) ; do	\
+		mkdir -p $(DESTDIR)$(DATA_DIR)/`dirname $$name`;	\
+        sed							\
 		    -e 's,ENVPREFIX,RSTART,g'				\
-		        < $$name > $(DESTDIR)$(DATA_DIR)/$$name;	\
+	        < $(srcdir)/$$name > $(DESTDIR)$(DATA_DIR)/$$name;	\
 		case `basename $(DESTDIR)$(DATA_DIR)/$$name` in		\
 		@*)							\
 		    ;;							\
 		*)							\
 		    chmod a+x $(DESTDIR)$(DATA_DIR)/$$name ;;		\
 		esac;							\
-	    else							\
-	        if [ -d $$name ] ; then					\
-	            mkdir -p $(DESTDIR)$(DATA_DIR)/$$name ;		\
-	        fi;							\
-	    fi;								\
 	done;								\
 									\
-	for name in `find ${srcdir}/contexts -print | grep -v CVS` ; do	\
-	    if test -f $$name; then					\
-	        sed							\
-	            -e 's,_PATH,$(DEFAULT_USER_PATH),g'			\
-	            -e 's,_MANPATH,$(DEFAULT_X_MANPATH),g'		\
-			< $$name > $(DESTDIR)$(DATA_DIR)/$$name ;	\
-	    else							\
-	        if [ -d $$name ] ; then					\
-	            mkdir -p $(DESTDIR)$(DATA_DIR)/$$name	;	\
-	        fi ;							\
-	    fi ;							\
+	for name in $(contexts_files) ; do	\
+		mkdir -p $(DESTDIR)$(DATA_DIR)/`dirname $$name`;	\
+        sed							\
+            -e 's,_PATH,$(DEFAULT_USER_PATH),g'			\
+            -e 's,_MANPATH,$(DEFAULT_X_MANPATH),g'		\
+			< $(srcdir)/$$name > $(DESTDIR)$(DATA_DIR)/$$name ;	\
 	done;								\
 									\
 	cd $(DESTDIR)$(DATA_DIR)/contexts;				\
@@ -151,17 +152,7 @@
 EXTRA_DIST +=								\
 	server.os2							\
 									\
-	commands/ListContexts						\
-	commands/x11r6/Terminal						\
-	commands/x11r6/LoadMonitor					\
-	commands/x11r6/@List						\
-	commands/@List							\
-	commands/ListGenericCommands					\
-									\
-	contexts/default						\
-	contexts/@Aliases						\
-	contexts/x11r6							\
-	contexts/@List							\
+	$(commands_files) $(contexts_files)		\
 									\
 	samples/commands/openwindows2/Terminal				\
 	samples/commands/openwindows2/LoadMonitor			\
